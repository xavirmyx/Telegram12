ğŸ“Œ Resumen Completo del Proyecto para Replit (Automatizado)

ğŸ† Objetivo

Este bot profesional de Telegram funciona con GroupHelp y BotFader para moderar grupos de mÃ¡s de 7,000 miembros, detectando y expulsando automÃ¡ticamente a los usuarios que:
	1.	Se quiten la foto de perfil o la cambien a privada.
	2.	Modifiquen su @username.

ğŸ”¹ Flujo de Trabajo Automatizado
	1.	Detecta cambios en la foto de perfil o @username.
	2.	EnvÃ­a una advertencia automÃ¡tica mencionando al usuario, dÃ¡ndole 5 minutos para revertir el cambio.
	3.	Si no revierte el cambio, el bot ejecuta /kick @username motivo.
	4.	Elimina el mensaje de advertencia una vez que el bot actÃºe.
	5.	Registra eventos en la base de datos (ID, fecha, hora y tipo de cambio).

ğŸ—‚ï¸ Estructura del Proyecto

ğŸ“‚ telegram_bot/
â”œâ”€â”€ ğŸ“œ config.py â†’ ConfiguraciÃ³n del bot (token, API, Webhook, etc.)
â”œâ”€â”€ ğŸ“œ bot.py â†’ CÃ³digo principal (manejo de eventos y webhooks)
â”œâ”€â”€ ğŸ“œ handlers.py â†’ DetecciÃ³n de cambios y aplicaciÃ³n de sanciones
â”œâ”€â”€ ğŸ“œ database.py â†’ Base de datos SQLite para registros
â”œâ”€â”€ ğŸ“œ requirements.txt â†’ LibrerÃ­as necesarias (aiogram, sqlite3)

ğŸ“ CÃ³digo Base (Automatizado y Sin Botones)

ğŸ”¹ 1. ConfiguraciÃ³n del bot (config.py)

TOKEN = "TU_TOKEN_AQUI"
WEBHOOK_URL = "https://tu-servidor.com/webhook"
WEBHOOK_PATH = "/webhook"
WEBAPP_HOST = "0.0.0.0"
WEBAPP_PORT = 8000

ğŸ”¹ 2. CÃ³digo Principal (bot.py)

import asyncio
import logging
from aiogram import Bot, Dispatcher, types
from aiogram.utils.executor import start_webhook
from config import TOKEN, WEBHOOK_URL, WEBHOOK_PATH, WEBAPP_HOST, WEBAPP_PORT
from handlers import handle_profile_change, handle_username_change

logging.basicConfig(level=logging.INFO)

bot = Bot(token=TOKEN)
dp = Dispatcher(bot)

async def on_startup(_):
    await bot.set_webhook(WEBHOOK_URL)
    logging.info("Bot iniciado y Webhook configurado.")

async def on_shutdown(_):
    await bot.delete_webhook()
    logging.info("Bot apagado.")

dp.register_message_handler(handle_profile_change, content_types=types.ContentType.NEW_CHAT_MEMBERS)
dp.register_message_handler(handle_username_change, content_types=types.ContentType.NEW_CHAT_MEMBERS)

if __name__ == '__main__':
    start_webhook(dispatcher=dp, webhook_path=WEBHOOK_PATH,
                  on_startup=on_startup, on_shutdown=on_shutdown,
                  host=WEBAPP_HOST, port=WEBAPP_PORT)

ğŸ”¹ 3. DetecciÃ³n de Cambios y ExpulsiÃ³n (handlers.py)

import asyncio
import logging
from aiogram import types
from database import save_warning, remove_warning, log_event

async def handle_profile_change(message: types.Message):
    user = message.from_user
    user_id = user.id
    chat_id = message.chat.id

    # SimulaciÃ³n de detecciÃ³n (reemplazar con API real de Telegram)
    profile_photo_exists = False  # Cambiar a True si tiene foto

    if not profile_photo_exists:
        warning_msg = await message.answer(
            f"âš ï¸ @{user.username}, has quitado su foto de perfil.\n"
            "Tienes 5 minutos para revertirlo o serÃ¡s expulsado."
        )

        save_warning(user_id, warning_msg.message_id)
        log_event(user_id, "Foto de perfil eliminada", chat_id)

        await asyncio.sleep(300)  # Esperar 5 minutos
        if remove_warning(user_id):
            await message.chat.kick(user_id)  # Expulsar usuario
            await message.answer(f"/kick @{user.username} No ha revertido su cambio en 5 minutos.")
            log_event(user_id, "Expulsado por no revertir cambio", chat_id)
            await warning_msg.delete()  # Eliminar advertencia

ğŸ”¹ 4. Base de Datos con Registros (database.py)

import sqlite3

conn = sqlite3.connect("bot_data.db")
cursor = conn.cursor()

cursor.execute("""
CREATE TABLE IF NOT EXISTS warnings (
    user_id INTEGER PRIMARY KEY,
    message_id INTEGER
)
""")

cursor.execute("""
CREATE TABLE IF NOT EXISTS logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER,
    event TEXT,
    chat_id INTEGER,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
)
""")
conn.commit()

def save_warning(user_id, message_id):
    cursor.execute("INSERT OR REPLACE INTO warnings (user_id, message_id) VALUES (?, ?)", (user_id, message_id))
    conn.commit()

def remove_warning(user_id):
    cursor.execute("DELETE FROM warnings WHERE user_id = ?", (user_id,))
    conn.commit()
    return cursor.rowcount > 0

def log_event(user_id, event, chat_id):
    cursor.execute("INSERT INTO logs (user_id, event, chat_id) VALUES (?, ?, ?)", (user_id, event, chat_id))
    conn.commit()

ğŸ”¹ 5. Requisitos (requirements.txt)

aiogram
sqlite3
asyncio
logging

ğŸš€ ExplicaciÃ³n para Replit

Este bot usa aiogram con Webhooks para manejar eventos en Telegram de manera eficiente y automatizada.
	1.	CÃ³mo funciona:
	â€¢	Detecta cambios en la foto de perfil o @username.
	â€¢	EnvÃ­a un mensaje automÃ¡tico de advertencia mencionando al usuario.
	â€¢	Si el usuario no revierte el cambio en 5 minutos, ejecuta /kick @username motivo.
	â€¢	Elimina el mensaje de advertencia despuÃ©s de la acciÃ³n.
	â€¢	Guarda los eventos en la base de datos.
	2.	CÃ³mo ejecutarlo en Replit:
	â€¢	Sube el cÃ³digo a Replit.
	â€¢	Instala las dependencias (pip install -r requirements.txt).
	â€¢	Configura el TOKEN de Telegram en config.py.
	â€¢	Inicia el bot (python bot.py).

ğŸ”¥ Siguientes Pasos

a. Â¿Quieres que el bot guarde un historial de todas las expulsiones con razÃ³n y fecha?
b. Â¿Necesitas integraciÃ³n con una API externa para reportes avanzados?